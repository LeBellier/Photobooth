#parse("camera/head.vm")
<script>	
	function restartLiveView() {
		$("#liveViewContainer img").each(function (idx, el) {
			el.src='$!{request.contextPath}/stream.mjpeg?t=' + Date.now();
		});
	}
	
	function liveStream() {
		getJson("$!{request.contextPath}/cameraConfig.json?reRead=true", function(config) {
			console.log(config);
			$("#section_liveStream").html('');
			var ractive = new Ractive({
				el: '#section_liveStream',
				template: '#tplLiveStream',
				data: {showFavToggle: true, contextPath:"$!{request.contextPath}"}
			});
			ractive.on({
				toggleLiveView: function(event) {
					$(event.node).parent().find("input").click();
				},
				setLiveView: function(event) {
					if(event.node.checked) {
						$("#liveViewContainer").show();
						$("#liveViewContainer").html('<img class="fullWidth" style="width: 100%" src="$!{request.contextPath}/stream.mjpeg?t=' + Date.now() + '" />');
					} else {
						$("#liveViewContainer").hide();
						$("#liveViewContainer img").attr("src", "");
					}
				}
			});
		}, function(textStatus) { alert('Error loading config: '+textStatus) });
	}
	
	function initUi() {
		var helpers = Ractive.defaults.data;
		Ractive.partials.tplConfigSetting = Ractive.parse($('#tplConfigSetting').text());
		helpers.lowercase = function(str) { return str? str.toLowerCase() : str };
		helpers.uppercase = function(str) { return str? str.toUpperCase() : str };
	
		liveStream();			
	}
	
	function getJson(url, successCallback, errorCallback) {
		$.ajax({
			cache: false,
			url: url
		}).done(function(data) {
			successCallback(data);
		}).fail(function(jqXHR, textStatus) {
			console.error("Error obtaining JSON from "+url+". " + textStatus);
			if(errorCallback) {
				errorCallback(textStatus);
			}
		});	
	}	
	
	$(document).ready(initUi);
</script>
<script type="text/ractive" id="tplLiveStream">
	#include("camera/liveStream.ractive")
</script>
<div class="fullWidth">
	<div class="sitesection" id="section_liveStream">
	</div>
</div>
#parse("camera/foot.vm")
