#parse("camera/head.vm")
#pageHead("Browse")

<form id="actForm" method="POST" action="" class="hidden">
	<input type="text" name="imgRefId" value="" />
	<input type="text" name="folder" value="" />
</form>
<script>
	function actFormSubmit(action, imgRefId, folder) {
		document.forms["actForm"].action = action;
		document.forms["actForm"]["imgRefId"].value = imgRefId;
		document.forms["actForm"]["folder"].value = folder;
		document.forms["actForm"].submit();
	}
	function dldpreview(id, folder) {
		actFormSubmit("$!request.contextPath/camfilepreview", id, folder)
	}
	function deletefile(id, name, folder) {
		if(confirm("Delete file "+name+"?")) {
			actFormSubmit("$!request.contextPath/deletefile", id, folder)
		}
	}
</script>
#set($needsSeparator = false)
#foreach($filesInFolder in $filesList.byFolder.entrySet())
	#if($filesInFolder.value.size()>0)
		#if($needsSeparator) <hr/> #end	
		#set($needsSeparator = true)
		<div>
			<div class="headline">$filesInFolder.key</div>
			<div>
				#foreach($fileRef in $filesInFolder.value)
					#set($odd = $foreach.index % 2)							
					<div class="fullWidth browseList #if($odd == 1) odd #else even #end">
						<span>$!fileRef.refId</span>
						- 
						<a href="javascript:dldpreview($!fileRef.refId, '$!filesInFolder.key')"><span>$!fileRef.filename</span></a> 
						<span class="smaller">
							<span>$!fileRef.filesizestr</span> 
							[<span>$!fileRef.filetypestr.replaceAll("image/","")</span>]
							<a href="javascript:deletefile($!fileRef.refId, '$!fileRef.filename', '$!filesInFolder.key')">delete</a>
						</span>
					</div>
				#end
			</div>
		</div>				
	#end
#end

#pageFoot()
#parse("camera/foot.vm")
